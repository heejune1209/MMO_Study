# 취약점 공격 개론

해킹이란 왜 일어나고 어떤 식으로 일어나는지 알아보자.

### 취약점 공격 원리

해킹의 꽃은 취약점 공격이다.

- 프로그램에 심각한 버그가 있다.
    
    ⇒ Null 체크를 안했을 때
    
- Stack Overflow, Heap Overflow, Use-After-Free 등 (C++ 기준)
    - 99.99% 확률로 크래시 나고 끝 (Null 크래시)
    - 극악의 확률로 (1) 코드의 흐름도 제어가능하고 (2) 실행되는 위치의 데이터도 조작 가능

메모리 오염의 예

C++에서 new를 하면 delete도 같이 책임을 지어야 하는데(생명주기) 

그거를 delete를 한 객체를 다시 사용한다고 할 때 온갖 메모리 오염 문제와 overflow 문제 등이 발생하게 된다.

overflow의 경우 예를들어 100byte짜리 배열을 만들었는데 실수로 200byte짜리 데이터를 넣게 되면 위에 있는 메모리까지 침범을 하게 돼서 쫙 밀어버리기 때문에 발생

### Stack Overflow

버그가 발생하는 가장 기본적인 형태

Stack Overflow란 말 그대로 stack 메모리를 침범해서 이상한 메모리를 건드렸을 때 발생하는 버그

Stack에 있는 정보들

함수를 호출하고 return을 할 때 돌아갈 코드 위치는 어떻게 알까?

⇒ Stack에서 저장 

그리고 함수 호출 시 필요한 데이터들을 stack에 저장하게 된다.

따라서 Stack Overflow가 발생해서 돌아갈 코드 위치 데이터가 이상한 값으로 덮였다면 프로그램을 그 사실을 모르기 때문에 이상한 곳으로 가서 코드를 실행하게 될 것이다.

바로 위의 경우가 극악의 확률로 (1) 코드의 흐름도 제어 가능하게 만드는 Stack Overflow 취약점 공격이다.

그리고 경우에 따라서 메모리 안에 있는 데이터도 조작을 할 수 있는 경우가 생기는데

예를 들어 파일을 업로드 하는 것을 생각해보자.

리니지와 같이 혈맹 마크를 직접 만들어서 업로드를 할 수 있도록 해줬는데 PNG 파일을 업로드 할 수 있다는 것은 생각보다 큰 영역을 조작 할 수 있다는 의미이다 

⇒ (2) 실행되는 위치의 데이터도 조작 가능

여기서 특정 포트를 열어서 원격으로 접근할 수 있는 실행되는 코드(shell code)를 업로드를 하게 된다면 아주 끔직한 일이 일어나게 된다.

따라서 위 2가지 경우를 합쳐서 생각해보면

Stack Overflow를 일으켜서 위의  shell code가 실행되는 주소로 이동하게끔 조작을 하게 되면 해킹이 가능하게 된다.

어떤 취약점 공격의 기초는 취약점을 발생 시켜서 해당 부분을 이용하는 것이다.

현재 만든 C# 서버의 경우 메모리 보안 부분이 잘되어 있어서 다행이다.